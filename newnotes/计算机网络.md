计算机网络
=========

计算机是人发明的
---------------

# 用上帝视角看网络结构
  * 跟送快递有很多相似的地方


# 计算机网络是典型的**分层结构**，也是理解分层模型的极好示例
* 物理层
* 链路层
* 网络层
* 传输层
* 应用层


# 物理层
* 指设备之间的物理连接
  * 可以是有线
    * 网线
    * 光纤
  * 可以是无线
    * WiFi
    * 3G
    * 4G
* 物理层解决信号的调制与解调
  * 即数字信号与模拟信号之间的转换及传输
* 保证通信的两端能够理解01 
* 把上层给到的数据转换为表示01的模拟信号传到电缆上
* 把从电缆接收到的数据转换为01
* 物理层还需要考虑
  * 信号的时钟同步
    * 为此使用了能够同步时钟信号的编码
      * 即曼彻斯特编码及其变种
  * 电压（流）的大小

# 链路层
* 链路层仅负责直接连接的设备间的通信
  * 实际上真正的网络通信也都是能过局域网一步步传出去的
* 只关心两台机器之间的信号
* 广播域
* 集线器
* 不同方式下链路层的实现有很多
  * 以太网
    * 载波侦听多路访问
    * 用了交换机以后，基本不存在载波侦听多路访问
  * WiFi
    * 载波侦听多路访问
  * GPRS，3G，4G
* 目前最广泛使用的就是以太网
  * 它的标准拓扑结构为总线型，
    * 总线型
* 在这一层，每个网卡会有一个全球唯一的MAC（Media Access Control Address）地址，用来标示这个设备的ID，虽然只在局域网内使用，但这个ID任然是唯一的
* 局域网之间的通信是通过MAC地址的，而非IP地址
* 计算机会通过ARP协议把IP地址转换为目标机器的MAC地址
* 交换机就是典型的链路层设备（也称二层设备）
* arp欺骗，网络风暴，广播风暴
* ping要关掉防火墙





# 网络层（IP层）
* 瘦腰模型
  * SQL
* 网络层负责把IP数据包（Packet）从起始机器送达目标机器
  * Best Effort
* 路由器
  * 真正的路由器，而非家用路由器
  * 家用路由器其实是NAT路由
* NAT网络地址转换
* IP地址的分类
  * A类
  * B类
  * C类
  * 广播地址
  * 
* IP地址，子网掩码与子网的划分
  * 
* 不关心是局域网还是广域网
  * 如果是局域网，下层会通过ARP协议把IP转换为MAC地址
* 路由器会根据网络结构选择如何转发分组
  * 各种路由协议
  * 路由表
* VPN一般是在这一层
  * 一般的VPN连接后电脑会多出一个IP地址
    * VPN某种程度上相当于把网线插到了VPN目标所在位置
* tracert
* find gfw location
* ICMP协议
* IPv6
* 带宽
* 延迟
* 域名来源

sudo iptables -t nat -A POSTROUTING -s 192.168.88.0/24 -o eth0 -j MASQUERADE
sudo iptables -t nat -A POSTROUTING -s 192.168.31.0/24 -o wlan0 -j MASQUERADE



# 传输层（TCP/UDP）
* 端口的概念在这一层提出


## UDP
  * 像信箱
  * 非连接型
  * 给定目标位置直接扔过去
  * 无响应，不知道有没有送到
  * 接收方会校验数据的正确性，所以送到的话一般来说是对的










## TCP
  * 通信模型
    * 面向连接
    * 服务端口
    * 客户端口
  * 包头
  * 握手
    * 分享初始的接收窗口大小
    * 确认对方可达
  * 保证按顺送达
  * 滑动窗口机制
    * 拥塞窗口，用于拥塞控制
      * 和式增加，积式减少（AIMD）
    * （对方的）接收窗口，用于不要发送过多的数据以至于对方处理不过来
    * 等对方确认收到了窗口前面的字节，再发送后面的数据，同时窗口往后滑动


# 应用层
* 直接使用TCP或UDP传输自己关心的数据，不关心下层细节（包头，重传，拥塞等）
* DHCP
* DNS
* HTTP

* 如何在系统中查看当前系统打开了多少连接
* 监听了哪个端口
* linux，ss命令
* netstat命令
